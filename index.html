<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>AI å‹•ç‰©çŸ­ç‰‡æç¤ºç”¢ç”Ÿå™¨ v2.2</title>
<style>
:root{--bg:#0b0b0c;--card:#15161a;--ink:#e9eef3;--muted:#a7b0ba;--accent:#7dd3fc}
*{box-sizing:border-box;font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial,'Noto Sans TC',sans-serif}
body{margin:0;background:linear-gradient(180deg,#0b0b0c,#101215);color:var(--ink)}
header{padding:16px;position:sticky;top:0;background:rgba(11,11,12,.85);backdrop-filter:saturate(150%) blur(8px);border-bottom:1px solid #1f2937}
h1{margin:0;font-size:20px;letter-spacing:.2px}
main{padding:16px;max-width:980px;margin:0 auto}
.card{background:#15161a;border:1px solid #262b36;border-radius:18px;padding:14px;margin-bottom:14px;box-shadow:0 8px 32px rgba(0,0,0,.25)}
.row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
@media (max-width:760px){.row{grid-template-columns:1fr}}
label{font-size:13px;color:var(--muted);display:block;margin:8px 0 6px}
select,input[type="text"]{width:100%;padding:10px 12px;background:#0f1114;border:1px solid #2b3340;border-radius:12px;color:var(--ink)}
.btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;border:1px solid #2b3340;background:#0f1114;color:var(--ink);padding:10px 14px;border-radius:12px;cursor:pointer}
.btn.primary{background:linear-gradient(135deg,#0891b2,#2563eb);border-color:transparent}
.btn:active{transform:translateY(1px)}
.chip{display:inline-block;padding:6px 10px;background:#0f1114;border:1px solid #2b3340;border-radius:999px;font-size:12px;margin:4px 6px 0 0;color:var(--muted)}
textarea{width:100%;min-height:240px;background:#0b0d10;color:#e5eef7;border:1px solid #2b3340;border-radius:14px;padding:12px;line-height:1.5}
.notice{font-size:12px;color:#a1a1aa}
.thumb{width:100%;max-height:200px;object-fit:cover;border-radius:12px;border:1px solid #2b3340;margin-top:8px}
.flex{display:flex;gap:8px;flex-wrap:wrap}
.grid-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px}
@media (max-width:760px){.grid-3{grid-template-columns:1fr}}
.small{font-size:12px;color:#9aa3ad}
</style>
</head>
<body>
<header>
  <h1>ğŸ¾ AI å‹•ç‰©çŸ­ç‰‡æç¤ºç”¢ç”Ÿå™¨ <span class="chip">v2.2 â€¢ ç¹ä¸­ä»‹é¢ / è‹±æ–‡è¼¸å‡º</span></h1>
  <div class="small">å›ºå®š 10 ç§’ã€9:16ã€‚ç”Ÿæˆè‹±æ–‡ä¸€æ®µå¼ Prompt + 3 å€‹è‹±æ–‡æ¨™é¡Œï¼ˆä¾èªæ°£è®ŠåŒ–ï¼‰ã€‚</div>
</header>
<main>
  <section class="card">
    <div class="row">
      <div>
        <label>æ¨¡å¼</label>
        <select id="mode">
          <option value="wildlife" selected>ğŸ¦ é‡å¤–é©šéšªæ¨¡å¼ (Wildlife Action)</option>
          <option value="pet">ğŸ§¸ å¯µç‰©ç©å…·æ¨¡å¼ (Pet & Toy)</option>
        </select>

        <label>é¡åˆ¥ï¼ˆä¸­æ–‡é¡¯ç¤º / è‹±æ–‡ç”Ÿæˆï¼‰</label>
        <select id="category"></select>

        <label>èªæ°£èˆ‡æƒ…ç·’</label>
        <select id="tone"></select>

        <label>å‹•ç‰©ï¼ˆä»¥é€—è™Ÿåˆ†éš”ï¼‰</label>
        <input id="animals" type="text" placeholder="ä¾‹å¦‚ï¼šbuffalo, lions, calf / cat, golden retriever" />

        <label>ç”Ÿç‰©ç¾¤è½ / åœ°é»</label>
        <select id="biome"></select>
      </div>
      <div>
        <div class="grid-3">
          <div>
            <label>å½±ç‰‡é•·åº¦</label>
            <input value="å›ºå®š 10 ç§’" disabled />
          </div>
          <div>
            <label>ç•«é¢æ¯”ä¾‹</label>
            <input value="å›ºå®š 9:16 ç›´å¼" disabled />
          </div>
          <div>
            <label>è¼¸å‡ºèªè¨€</label>
            <input value="English" disabled />
          </div>
        </div>

        <div class="flex" style="margin-top:10px">
          <label class="chip"><input id="ambient" type="checkbox" checked /> ç’°å¢ƒéŸ³æ•ˆ</label>
          <label class="chip"><input id="music" type="checkbox" /> èƒŒæ™¯éŸ³æ¨‚</label>
        </div>

        <label style="margin-top:10px;">ä¸Šå‚³åœ–ç‰‡è‡ªå‹•åµæ¸¬å‹•ç‰©ï¼ˆç€è¦½å™¨ç«¯ï¼‰</label>
        <input id="img" type="file" accept="image/*" />
        <img id="thumb" class="thumb" style="display:none" alt="preview" />
        <div class="notice">è‹¥æ¨¡å‹è¼‰å…¥å¤±æ•—ï¼Œå¯ç›´æ¥æ‰‹å‹•è¼¸å…¥å‹•ç‰©åç¨±ã€‚</div>
      </div>
    </div>

    <div class="flex" style="margin-top:14px">
      <button id="gen" class="btn primary">âš¡ ç”¢ç”Ÿ</button>
      <button id="copy" class="btn">ğŸ“‹ è¤‡è£½</button>
      <button id="save" class="btn">â¬‡ï¸ ä¸‹è¼‰ TXT</button>
      <button id="reset" class="btn">â™»ï¸ é‡è¨­</button>
    </div>
  </section>

  <section class="card">
    <label>è¼¸å‡ºçµæœï¼ˆè‹±æ–‡ Prompt + æ¨™é¡Œå»ºè­°ï¼‰</label>
    <textarea id="out" spellcheck="false" placeholder="English prompt & title ideas will appear here..."></textarea>
  </section>
</main>

<script>
// ---------- Dictionaries (UI zh-TW -> internal en) ----------
const MAP = {
  wildlife: {
    categories: [
      ["æ é£Ÿç‹©çµ", "Predator Hunt"],
      ["æ½›è¡Œä¼æ“Š", "Predator Ambush"],
      ["æ²³å²¸æ”»æ“Š", "River Attack"],
      ["åº­é™¢é­é‡", "Backyard Encounter"]
    ],
    tones: [
      ["å²è©©ç´šå¼µåŠ›", "Epic"],
      ["ç·Šå¼µæ‡¸ç–‘", "Tense"],
      ["æˆ²åŠ‡è¡çª", "Dramatic"]
    ],
    biomes: [
      ["éæ´²è‰åŸ", "African savanna"],
      ["æ²³ç•”æ°´å‘", "Riverbank watering hole"],
      ["å®¶åº­åº­é™¢é‡å€", "Backyard wilderness zone"]
    ],
    defaultAnimals: "buffalo, lions, calf"
  },
  pet: {
    categories: [
      ["ç©å…·é¨·å‹•", "Toy Antics"],
      ["è¿·ä½ å†’éšª", "Mini Adventure"],
      ["å¯æ„›æƒ¡ä½œåŠ‡", "Cute Prank"]
    ],
    tones: [
      ["å¯æ„›", "Cute"],
      ["æç¬‘", "Comedic"],
      ["æœæ°£", "Playful"]
    ],
    biomes: [
      ["æº«é¦¨å®¢å»³", "cozy living room"],
      ["äº®é¢å»šæˆ¿åœ°æ¿", "kitchen floor"],
      ["å¾Œé™¢è‰åœ°", "backyard lawn"]
    ],
    defaultAnimals: "cat, golden retriever"
  }
};

// Templates for scenes (English), camera phrases auto-injected
const TPL = {
  wildlife: {
    "Predator Hunt": [
      "A {PRED} bursts from tall grass and chases {PREY} across the {BIOME}, camera tracks low and fast, dust glowing in cinematic slow motion under golden light.",
      "{PRED} close the gap on {PREY} over the {BIOME}, feet pounding as the lens whips past ground-level brush in slow motion."
    ],
    "Predator Ambush": [
      "Hidden in reeds at the {BIOME}, {PRED} explode toward {PREY} as the camera snaps to a tight close-up, debris flashing in slow motion.",
      "From shadow to sun, {PRED} lunge at {PREY} beside the {BIOME}, handheld shot surging forward in dramatic slow motion."
    ],
    "River Attack": [
      "At the edge of the {BIOME}, {PRED} surge from mud toward {PREY}, water sprays across the lens while the shot drifts low in slow motion.",
      "Whitewater erupts as {PRED} strike at {PREY} near the {BIOME}, camera glides inches above the surface in cinematic slow motion."
    ],
    "Backyard Encounter": [
      "A curious {PRED} prowls into a suburban {BIOME}, pets scatter as the camera pans close around fences and grass in playful slow motion.",
      "{PRED} steps from shadows into a lit {BIOME}, the lens follows tight and steady, turning everyday turf into a tense stage."
    ]
  },
  pet: {
    "Toy Antics": [
      "A {PET1} chases a squeaky toy while a {PET2} skids after it, camera pans close as sunlight flickers across the floor in gentle slow motion."
    ],
    "Mini Adventure": [
      "A {PET1} rides a toy car past pillow obstacles while {PET2} waves a tiny flag, handheld shot capturing cheerful slow motion."
    ],
    "Cute Prank": [
      "A {PET1} sneaks behind a robot vacuum with a foam sword as {PET2} watches, the lens tilts in playful slow motion."
    ]
  }
};

// Tone keyword pools for title ideas
const TITLE = {
  Epic: ["Fury", "Glory", "Legend", "Unstoppable", "Rising", "Awakening"],
  Tense: ["Edge", "Close Call", "Last Stand", "Tension", "Near Miss", "On the Brink"],
  Dramatic: ["Clash", "Twist", "Reversal", "Storm", "Collision", "Turning Point"],
  Cute: ["Cuteness", "Snuggles", "Sweet Chaos", "Tiny Legend", "Heart Melt"],
  Comedic: ["Toy Trouble", "Goofball", "Silly Chase", "Laugh Track", "Oops"],
  Playful: ["Playtime", "Sunny Joy", "Happy Sprint", "Wiggle Dance", "Little Adventure"]
};

// Simple helpers
function el(id){return document.getElementById(id)}
function sample(arr){return arr[Math.floor(Math.random()*arr.length)]}

// Populate selects in zh-TW
function populate(mode){
  const cfg = MAP[mode];
  // category
  el('category').innerHTML="";
  cfg.categories.forEach(([zh,en])=>{
    const o=document.createElement('option'); o.textContent=zh; o.value=en; el('category').appendChild(o);
  });
  // tone
  el('tone').innerHTML="";
  cfg.tones.forEach(([zh,en])=>{
    const o=document.createElement('option'); o.textContent=zh; o.value=en; el('tone').appendChild(o);
  });
  // biome
  el('biome').innerHTML="";
  cfg.biomes.forEach(([zh,en])=>{
    const o=document.createElement('option'); o.textContent=zh; o.value=en; el('biome').appendChild(o);
  });
  // animals default
  el('animals').value = cfg.defaultAnimals;
}
let currentMode='wildlife';
populate(currentMode);

// Mode switch
el('mode').addEventListener('change',(e)=>{currentMode=e.target.value; populate(currentMode); el('out').value=''})

// Image detection (lazy-load TFJS)
let mobilenetModel=null;
async function ensureModel(){
  if(mobilenetModel) return mobilenetModel;
  await new Promise((res,rej)=>{const s=document.createElement('script');s.src='https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.20.0/dist/tf.min.js';s.onload=res;s.onerror=()=>rej(new Error('tfjs load fail'));document.head.appendChild(s)});
  await new Promise((res,rej)=>{const s=document.createElement('script');s.src='https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet@2.1.0';s.onload=res;s.onerror=()=>rej(new Error('mobilenet load fail'));document.head.appendChild(s)});
  mobilenetModel = await mobilenet.load();
  return mobilenetModel;
}
el('img').addEventListener('change', async (e)=>{
  const f=e.target.files[0]; if(!f) return;
  const url=URL.createObjectURL(f);
  const thumb=el('thumb'); thumb.src=url; thumb.style.display='block';
  try{
    const model = await ensureModel();
    const img = new Image();
    img.onload = async ()=>{
      const preds = await model.classify(img);
      const words = preds.map(p=>p.className.split(',')[0].toLowerCase());
      const pick = [...new Set(words)].slice(0,3).join(', ');
      el('animals').value = el('animals').value ? (el('animals').value + ', ' + pick) : pick;
    };
    img.src = url;
  }catch(err){ console.warn(err); /* fail silently */ }
});

// Build one-paragraph English prompt + 3 titles
function buildOutput(){
  const category = el('category').value; // English key
  const tone = el('tone').value;         // English key
  const biome = el('biome').value;       // English phrase
  const animals = (el('animals').value||'').toLowerCase();

  // Wildlife roles
  const PRED = animals.match(/lion|lions|leopard|hyena|hyenas|cheetah|coyote|fox|wild dog/)?.[0] || (currentMode==='wildlife' ? 'lions' : 'puppy');
  const PREY = animals.match(/zebra|antelope|gazelle|calf|dog|cat|warthog|deer/)?.[0] || (currentMode==='wildlife' ? 'prey' : 'toy');

  let sentence;
  if(currentMode==='wildlife'){
    const tpl = TPL.wildlife[category] || TPL.wildlife["Predator Hunt"];
    sentence = sample(tpl).replaceAll("{PRED}", PRED).replaceAll("{PREY}", PREY).replaceAll("{BIOME}", biome);
  }else{
    // Pets: choose PET1/PET2
    const PET1 = animals.match(/cat|kitten|puppy|dog|hamster|parrot|turtle|rabbit|corgi|poodle|golden retriever/)?.[0] || "puppy";
    const PET2 = animals.match(/cat|kitten|puppy|dog|hamster|parrot|turtle|rabbit|corgi|poodle|golden retriever/)?.[0] || "cat";
    const tpl = TPL.pet[category] || TPL.pet["Toy Antics"];
    sentence = sample(tpl).replaceAll("{PET1}", PET1).replaceAll("{PET2}", PET2);
  }

  // Force 10s 9:16 implied cues already in templates (slow motion, camera tracks low, etc.)

  // Title ideas (tone-aware)
  const pool = TITLE[tone] || ["The Chase","Wild Clash","Untamed"];
  function pick3(list){
    const copy=[...list]; const out=[];
    while(out.length<3 && copy.length){ out.push(copy.splice(Math.floor(Math.random()*copy.length),1)[0]); }
    return out;
  }
  const titles = pick3(pool);

  return `Prompt:\n${sentence}\n\nTitle ideas:\n1. ${titles[0]}\n2. ${titles[1]}\n3. ${titles[2]}`;
}

el('gen').addEventListener('click', ()=>{
  el('out').value = buildOutput();
  el('gen').animate([{transform:'scale(1)'},{transform:'scale(.98)'},{transform:'scale(1)'}],{duration:180});
});
el('copy').addEventListener('click', async ()=>{
  const t = el('out').value.trim(); if(!t){alert('è«‹å…ˆç”¢ç”Ÿå…§å®¹'); return;}
  await navigator.clipboard.writeText(t); alert('å·²è¤‡è£½ Prompt èˆ‡æ¨™é¡Œ');
});
el('save').addEventListener('click', ()=>{
  const blob = new Blob([el('out').value||''], {type:'text/plain'});
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'animal_prompt.txt'; a.click();
});
el('reset').addEventListener('click', ()=>{
  populate(currentMode); el('out').value=''; el('thumb').style.display='none';
});
</script>
</body>
</html>
